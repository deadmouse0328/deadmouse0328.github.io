<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>任旸晖 市场监督管理局实习 七月22 至 26日SQL学习笔记:</title>
	</head>
<body>
<h2>任旸晖 市场监督管理局实习 七月22 至 26日SQL学习笔记:</h2>

<h3>22日：</h3>

<ol start="0">
	<li>软件安装和部署:<br/>我MySQL使用DataGrip和远程ssh连接达梦数据库进行SQL的学习;</li>
	<li>入门基础MySQL语法:

		<ul>
			<li>DDL: 数据定义语言，用来定义数据库对象（数据库、表、字段）</li>
			<li>DML: 数据操作语言，用来对数据库表中的数据进行增删改</li>
			<li>DQL: 数据查询语言，用来查询数据库中表的记录</li>
			<li>DCL: 数据控制语言，用来创建数据库用户、控制数据库的控制权限</li>
		</ul></li>
	<li> 对于DDL基础查询操作（查询，创建，删除，使用）：

<pre><code class="code-highlighted code-sql">SHOW, <span class="syntax-all syntax-keyword">SELECT</span>, CREATE, DROP, USE;</code></pre></li>
	<li> DML 添加数据功能：

		<ul>
			<li>添加数据，更新和删除数据:</li>
		</ul></li>
</ol>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">INSERT INTO</span> 表名 (字段名1, 字段名2, ...) <span class="syntax-all syntax-keyword">VALUES</span> (值1, 值2, ...);
<span class="syntax-all syntax-keyword">UPDATE</span> 表名 <span class="syntax-all syntax-keyword">SET</span> 字段名1 <span class="syntax-all syntax-keyword">=</span> 值1, 字段名2 <span class="syntax-all syntax-keyword">=</span> 值2, ... [ <span class="syntax-all syntax-keyword">WHERE</span> 条件 ];</code></pre>

<p><mark>遇到问题</mark>:</p>

<p>当用SQLShell连接本地服务器时没有带端口号。解决方法:</p>

<pre><code class="code-highlighted code-sql">root@<span class="syntax-all syntax-constant">127</span>.<span class="syntax-all syntax-constant">0</span>.<span class="syntax-all syntax-constant">0</span>.<span class="syntax-all syntax-constant">1</span>:<span class="syntax-all syntax-constant">3306</span></code></pre>

<figure><img src="221721366126_.pic.jpg"/></figure>

<h3>23日：</h3>

<ol start="0">
	<li>确定了接下来两周的SQL学习框架:</li>
</ol>

<figure><img src="251721611731_.pic_hd.jpg"/></figure>

<ol>
	<li>DQL数据查询（基础语法）：</li>
</ol>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span>
	字段列表
<span class="syntax-all syntax-keyword">FROM</span>
	表名字段
<span class="syntax-all syntax-keyword">WHERE</span>
	条件列表
<span class="syntax-all syntax-keyword">GROUP BY</span>
	分组字段列表
<span class="syntax-all syntax-keyword">HAVING</span>
	分组后的条件列表
<span class="syntax-all syntax-keyword">ORDER BY</span>
	排序字段列表
<span class="syntax-all syntax-keyword">LIMIT</span>
	分页参数</code></pre>

<p>执行顺序：</p>

<p>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p>

<ul>
	<li>聚合函数:</li>
</ul>

<pre><code class="code-highlighted code-sql">count, max, min, avg, sum;
<span class="syntax-all syntax-keyword">SELECT</span> 聚合函数(字段列表) <span class="syntax-all syntax-keyword">FROM</span> 表名;</code></pre>

<ul>
	<li>分组查询(group by):</li>
</ul>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表名 [ <span class="syntax-all syntax-keyword">WHERE</span> 条件 ] <span class="syntax-all syntax-keyword">GROUP BY</span> 分组字段名 [ <span class="syntax-all syntax-keyword">HAVING</span> 分组后的过滤条件 ];</code></pre>

<p>注意事项：</p>

<ul>
	<li> where不能对聚合函数进行判断，而having可以。

		<ul>
			<li>执行顺序：where &gt; 聚合函数 &gt; having。</li>
		</ul></li>
	<li>排序查询（order by）：</li>
</ul>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表名 <span class="syntax-all syntax-keyword">ORDER BY</span> 字段1 排序方式1,字段2 排序方式2;</code></pre>

<p>索引从0开始，起始索引 = （查询页码 - 1） <em> 每页显示记录数;</em></p>

<h3>24日：</h3>

<ol start="0">
	<li>连接了服务器中的达梦数据库，安装并配置好了环境。</li>
</ol>

<figure><img src="731721814859_.pic.jpg"/></figure>

<ol>
	<li>DCL用户管理:</li>
</ol>

<p>查询, 创建,删除用户：</p>

<pre><code class="code-highlighted code-sql">USE mysql;
<span class="syntax-all syntax-keyword">SELECT</span> <span class="syntax-all syntax-keyword">*</span> <span class="syntax-all syntax-keyword">FROM</span> user;

<span class="syntax-all syntax-keyword">CREATE</span> <span class="syntax-all syntax-keyword">USER</span> &#39;<span class="syntax-all syntax-entity">用户名</span>&#39;@<span class="syntax-all syntax-string">&#39;主机名&#39;</span> IDENTIFIED BY <span class="syntax-all syntax-string">&#39;密码&#39;</span>;

<span class="syntax-all syntax-keyword">ALTER</span> <span class="syntax-all syntax-keyword">USER</span> <span class="syntax-all syntax-string">&#39;用户名&#39;</span>@<span class="syntax-all syntax-string">&#39;主机名&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="syntax-all syntax-string">&#39;新密码&#39;</span>;</code></pre>

<p>权限:</p>

<table>
	<thead>
		<tr>
			<th>
				权限
			</th>
			<th>
				说明
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				ALL
			</td>
			<td>
				所有权限
			</td>
		</tr>
		<tr>
			<td>
				SELECT
			</td>
			<td>
				查询
			</td>
		</tr>
		<tr>
			<td>
				INSERT
			</td>
			<td>
				插入
			</td>
		</tr>
		<tr>
			<td>
				UPDATE
			</td>
			<td>
				修改
			</td>
		</tr>
		<tr>
			<td>
				DELETE
			</td>
			<td>
				删除
			</td>
		</tr>
		<tr>
			<td>
				ALTER
			</td>
			<td>
				修改表
			</td>
		</tr>
		<tr>
			<td>
				DROP
			</td>
			<td>
				删除数据库/表/视图
			</td>
		</tr>
		<tr>
			<td>
				CREATE
			</td>
			<td>
				创建数据库/表
			</td>
		</tr>
	</tbody>
</table>

<p>查询权限：</p>

<pre><code class="code-highlighted code-sql">SHOW GRANTS FOR <span class="syntax-all syntax-string">&#39;用户名&#39;</span>@<span class="syntax-all syntax-string">&#39;主机名&#39;</span>;</code></pre>

<p>授予权限：</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">GRANT</span> 权限列表 <span class="syntax-all syntax-keyword">ON</span> <span class="syntax-all syntax-constant">数据库名</span>.<span class="syntax-all syntax-constant">表名</span> TO <span class="syntax-all syntax-string">&#39;用户名&#39;</span>@<span class="syntax-all syntax-string">&#39;主机名&#39;</span>;</code></pre>

<p>撤销权限：</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">REVOKE</span> 权限列表 <span class="syntax-all syntax-keyword">ON</span> <span class="syntax-all syntax-constant">数据库名</span>.<span class="syntax-all syntax-constant">表名</span> <span class="syntax-all syntax-keyword">FROM</span> <span class="syntax-all syntax-string">&#39;用户名&#39;</span>@<span class="syntax-all syntax-string">&#39;主机名&#39;</span>;</code></pre>

<p><mark>遇到问题</mark>:</p>

<ol>
	<li>遇到server登录方式的失败，解决方法：</li>
</ol>

<pre><code class="code-highlighted code-sql">su <span class="syntax-all syntax-keyword">-</span> dmdba
cd <span class="syntax-all syntax-keyword">/</span>home<span class="syntax-all syntax-keyword">/</span>dmdba<span class="syntax-all syntax-keyword">/</span>dmdbms<span class="syntax-all syntax-keyword">/</span>bin
.<span class="syntax-all syntax-keyword">/</span>disql SYSDBA<span class="syntax-all syntax-keyword">/</span><span class="syntax-all syntax-string">&#39;&quot;Hn@dameng123&quot;&#39;</span>@localhost:<span class="syntax-all syntax-constant">5236</span></code></pre>

<ol start="2">
	<li>无法使用smb共享地址进行连接（暂无解决）:</li>
</ol>

<pre><code class="code-highlighted code-sql">smb:\\<span class="syntax-all syntax-constant">10</span>.<span class="syntax-all syntax-constant">0</span>.<span class="syntax-all syntax-constant">5</span>.<span class="syntax-all syntax-constant">26</span>\dmd$\TEST </code></pre>

<h3>25日：</h3>

<ol>
	<li>字符串函数：</li>
</ol>

<table>
	<thead>
		<tr>
			<th>
				函数
			</th>
			<th>
				功能
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				CONCAT(s1, s2, …, sn)
			</td>
			<td>
				字符串拼接
			</td>
		</tr>
		<tr>
			<td>
				LOWER(str)
			</td>
			<td>
				将字符串转小写
			</td>
		</tr>
		<tr>
			<td>
				UPPER(str)
			</td>
			<td>
				字符串大写
			</td>
		</tr>
		<tr>
			<td>
				LPAD(str, n, pad)
			</td>
			<td>
				左填充，达到n个字符串长度
			</td>
		</tr>
		<tr>
			<td>
				RPAD(str, n, pad)
			</td>
			<td>
				右填充
			</td>
		</tr>
		<tr>
			<td>
				TRIM(str)
			</td>
			<td>
				去掉字符串头部和尾部的空格
			</td>
		</tr>
		<tr>
			<td>
				SUBSTRING(str, start, len)
			</td>
			<td>
				返回从字符串str从start位置起的len个长度的字符串
			</td>
		</tr>
		<tr>
			<td>
				REPLACE(column, source, replace)
			</td>
			<td>
				替换字符串
			</td>
		</tr>
	</tbody>
</table>

<p>常用函数：</p>

<table>
	<thead>
		<tr>
			<th>
				函数
			</th>
			<th>
				功能
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				CURDATE()
			</td>
			<td>
				返回当前日期
			</td>
		</tr>
		<tr>
			<td>
				CURTIME()
			</td>
			<td>
				返回当前时间
			</td>
		</tr>
		<tr>
			<td>
				NOW()
			</td>
			<td>
				返回当前日期和时间
			</td>
		</tr>
		<tr>
			<td>
				YEAR(date)
			</td>
			<td>
				获取指定date的年份
			</td>
		</tr>
		<tr>
			<td>
				MONTH(date)
			</td>
			<td>
				获取指定date的月份
			</td>
		</tr>
		<tr>
			<td>
				DAY(date)
			</td>
			<td>
				获取指定date的日期
			</td>
		</tr>
		<tr>
			<td>
				DATE_ADD(date, INTERVAL type)
			</td>
			<td>
				返回一个日期/时间值加上一个时间间隔expr后的时间值
			</td>
		</tr>
		<tr>
			<td>
				DATEDIFF(date1, date2)
			</td>
			<td>
				返回起始时间date1和结束时间date2之间的天数
			</td>
		</tr>
	</tbody>
</table>

<p>流程函数:</p>

<table>
	<tbody>
		<tr>
			<td>
				IF(value, t, f)
			</td>
			<td>
				如果value为true，则返回t，否则返回f
			</td>
		</tr>
		<tr>
			<td>
				IFNULL(value1, value2)
			</td>
			<td>
				如果value1不为空，返回value1，否则返回value2
			</td>
		</tr>
		<tr>
			<td>
				CASE WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END
			</td>
			<td>
				如果val1为true，返回res1，… 否则返回default默认值
			</td>
		</tr>
		<tr>
			<td>
				CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END
			</td>
			<td>
				如果expr的值等于val1，返回res1，… 否则返回default默认值
			</td>
		</tr>
	</tbody>
</table>

<ol start="2">
	<li>约束：</li>
</ol>

<table>
	<thead>
		<tr>
			<th>
				约束
			</th>
			<th>
				描述
			</th>
			<th>
				关键字
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				非空约束
			</td>
			<td>
				限制该字段的数据不能为null
			</td>
			<td>
				NOT NULL
			</td>
		</tr>
		<tr>
			<td>
				唯一约束
			</td>
			<td>
				保证该字段的所有数据都是唯一、不重复的
			</td>
			<td>
				UNIQUE
			</td>
		</tr>
		<tr>
			<td>
				主键约束
			</td>
			<td>
				主键是一行数据的唯一标识，要求非空且唯一
			</td>
			<td>
				PRIMARY KEY
			</td>
		</tr>
		<tr>
			<td>
				默认约束
			</td>
			<td>
				保存数据时，如果未指定该字段的值，则采用默认值
			</td>
			<td>
				DEFAULT
			</td>
		</tr>
		<tr>
			<td>
				检查约束 
			</td>
			<td>
				保证字段值满足某一个条件
			</td>
			<td>
				CHECK
			</td>
		</tr>
		<tr>
			<td>
				外键约束
			</td>
			<td>
				用来让两张图的数据之间建立连接, 数据的一致性和完整性
			</td>
			<td>
				FOREIGN KEY
			</td>
		</tr>
	</tbody>
</table>

<p>常见约束：<br/></p>

<table>
	<thead>
		<tr>
			<th>
				约束条件
			</th>
			<th>
				关键字
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				主键
			</td>
			<td>
				PRIMARY KEY
			</td>
		</tr>
		<tr>
			<td>
				自动增长
			</td>
			<td>
				AUTO_INCREMENT
			</td>
		</tr>
		<tr>
			<td>
				不为空
			</td>
			<td>
				NOT NULL
			</td>
		</tr>
		<tr>
			<td>
				唯一
			</td>
			<td>
				UNIQUE
			</td>
		</tr>
		<tr>
			<td>
				逻辑条件
			</td>
			<td>
				CHECK
			</td>
		</tr>
		<tr>
			<td>
				默认值
			</td>
			<td>
				DEFAULT
			</td>
		</tr>
	</tbody>
</table>

<p>Example:</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">create</span> <span class="syntax-all syntax-keyword">table</span> <span class="syntax-all syntax-entity">user</span>(
    id <span class="syntax-all syntax-keyword">int</span> <span class="syntax-all syntax-keyword">primary key</span> auto_increment comment <span class="syntax-all syntax-string">&#39;主键&#39;</span>,
    name <span class="syntax-all syntax-keyword">varchar</span>(<span class="syntax-all syntax-constant">10</span>) <span class="syntax-all syntax-keyword">not null</span> unique comment <span class="syntax-all syntax-string">&#39;姓名&#39;</span>,
    age <span class="syntax-all syntax-keyword">int</span> <span class="syntax-all syntax-keyword">check</span> ( age <span class="syntax-all syntax-keyword">&gt;</span> <span class="syntax-all syntax-constant">0</span> <span class="syntax-all syntax-keyword">and</span> age <span class="syntax-all syntax-keyword">&lt;=</span> <span class="syntax-all syntax-constant">120</span> ) comment <span class="syntax-all syntax-string">&#39;年龄&#39;</span>,
    status <span class="syntax-all syntax-keyword">char</span>(<span class="syntax-all syntax-constant">1</span>) default <span class="syntax-all syntax-constant">1</span> comment <span class="syntax-all syntax-string">&#39;状态&#39;</span>,
    gender <span class="syntax-all syntax-keyword">char</span>(<span class="syntax-all syntax-constant">1</span>) comment <span class="syntax-all syntax-string">&#39;性别&#39;</span>

) comment <span class="syntax-all syntax-string">&#39;用户表&#39;</span>;</code></pre>

<ol start="3">
	<li> 外键约束（添加）：</li>
</ol>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">CREATE</span> <span class="syntax-all syntax-keyword">TABLE</span> <span class="syntax-all syntax-entity">表名</span>(
	字段名 字段类型,
	[<span class="syntax-all syntax-keyword">CONSTRAINT</span>] [外键名称] <span class="syntax-all syntax-keyword">FOREIGN KEY</span>(外键字段名) <span class="syntax-all syntax-keyword">REFERENCES</span> 主表(主表列名)
);
<span class="syntax-all syntax-keyword">ALTER</span> <span class="syntax-all syntax-keyword">TABLE</span> 表名 ADD <span class="syntax-all syntax-keyword">CONSTRAINT</span> 外键名称 <span class="syntax-all syntax-keyword">FOREIGN KEY</span> (外键字段名) <span class="syntax-all syntax-keyword">REFERENCES</span> 主表(主表列名);</code></pre>

<p>删除外键：</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">ALTER</span> <span class="syntax-all syntax-keyword">TABLE</span> 表名 DROP <span class="syntax-all syntax-keyword">FOREIGN KEY</span> 外键名;</code></pre>

<h3>26日：</h3>

<h4>多表查询:</h4>

<ol>
	<li>多表关系</li>
</ol>

<ul>
	<li>一对多：在多的一方建立外键，指向一的一方的主键</li>
	<li>多对多：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</li>
	<li>一对一：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</li>
</ul>

<ol start="2">
	<li>内连接查询（隐式与显式）：</li>
</ol>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表1, 表2 <span class="syntax-all syntax-keyword">WHERE</span> 条件 ...;
<span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表1 [ INNER ] <span class="syntax-all syntax-keyword">JOIN</span> 表2 <span class="syntax-all syntax-keyword">ON</span> 连接条件 ...;</code></pre>

<ol start="3">
	<li>外连接查询(左外连接和右外连接）：</li>
</ol>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-comment">-- 左
</span><span class="syntax-all syntax-keyword">select</span> e.<span class="syntax-all syntax-keyword">*</span>, <span class="syntax-all syntax-constant">d</span>.<span class="syntax-all syntax-constant">name</span> <span class="syntax-all syntax-keyword">from</span> employee <span class="syntax-all syntax-keyword">as</span> e <span class="syntax-all syntax-keyword">left outer join</span> dept <span class="syntax-all syntax-keyword">as</span> d <span class="syntax-all syntax-keyword">on</span> <span class="syntax-all syntax-constant">e</span>.<span class="syntax-all syntax-constant">dept</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">d</span>.<span class="syntax-all syntax-constant">id</span>;
<span class="syntax-all syntax-comment">-- 右
</span><span class="syntax-all syntax-keyword">select</span> <span class="syntax-all syntax-constant">d</span>.<span class="syntax-all syntax-constant">name</span>, e.<span class="syntax-all syntax-keyword">*</span> <span class="syntax-all syntax-keyword">from</span> employee <span class="syntax-all syntax-keyword">as</span> e <span class="syntax-all syntax-keyword">right outer join</span> dept <span class="syntax-all syntax-keyword">as</span> d <span class="syntax-all syntax-keyword">on</span> <span class="syntax-all syntax-constant">e</span>.<span class="syntax-all syntax-constant">dept</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">d</span>.<span class="syntax-all syntax-constant">id</span>;</code></pre>

<ol start="4">
	<li>自连接查询:</li>
</ol>

<p>当前表与自身的连接查询，自连接必须使用表别名，自连接查询，可以是内连接查询，也可以是外连接查询。</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表A 别名A <span class="syntax-all syntax-keyword">JOIN</span> 表A 别名B <span class="syntax-all syntax-keyword">ON</span> 条件 ...;</code></pre>

<ol start="5">
	<li>联合查询 union, union all</li>
</ol>

<p>把多次查询的结果合并，形成一个新的查询集。</p>

<pre><code class="code-highlighted code-sql"><span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表A ...
<span class="syntax-all syntax-keyword">UNION</span> [ALL]
<span class="syntax-all syntax-keyword">SELECT</span> 字段列表 <span class="syntax-all syntax-keyword">FROM</span> 表B ...</code></pre>

<p><mark>遇到问题</mark></p>

<ol>
	<li>目前无法吧xlsx文件用工具导入服务器上的数据库，可能需要创建cfg的配置文件，或者使用达梦客户端dts工具（暂未解决）：</li>
</ol>

<figure><img src="871721912919_.pic.jpg"/></figure>

</body>
</html>

